<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Churrasco do Chefe - Atendimento</title>
<style>
  body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:0; display:flex; flex-direction:column; height:100vh; }
  #chat { flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; gap:6px; }
  .msg-bot, .msg-user { margin:6px 0; padding:8px 12px; border-radius:8px; max-width:90%; word-wrap:break-word; }
  .msg-bot { background:#222; align-self:flex-start; }
  .msg-user { background:#444; align-self:flex-end; }
  button { cursor:pointer; border:none; border-radius:5px; padding:6px 12px; margin:3px; }
  .cat-btn { background:#ff6a00; color:#fff; font-weight:bold; }
  .item-btn { background:#333; color:#fff; margin-top:4px; display:block; width:100%; text-align:left; }
  #inputArea { display:flex; padding:10px; background:#222; }
  #msgBox { flex:1; padding:6px; border-radius:5px; border:none; margin-right:5px; background:#333; color:#fff; }
  #cartBox { background:#1a1a1a; padding:10px; border-radius:8px; margin:5px; }
  .cart-item { display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; }
  .small-btn { padding:2px 6px; font-size:12px; background:#555; color:#fff; border-radius:3px; margin-left:2px; }
</style>
</head>
<body>

<div id="chat"></div>

<div id="cartBox">
  <strong>Carrinho:</strong>
  <div id="cartList">Vazio</div>
  <div id="subtotalText">Subtotal: R$0,00</div>
</div>

<div id="inputArea">
  <input type="text" id="msgBox" placeholder="Digite aqui..." />
  <button id="sendBtn">Enviar</button>
</div>

<script>
const WA_NUMBER = "5521987001907"; // n√∫mero do WhatsApp do estabelecimento
const PRODUCTS = {
  "Espetos": { "Contra fil√©":12,"Carne com bacon":10,"Medalh√£o de carne":12,"Lingui√ßa Toscana":8,"Lingui√ßa de frango":8,"Lingui√ßa mineira":8,"Tulipa":10,"Drumet":10,"Cora√ß√£o":12,"Medalh√£o de frango":12,"Queijo coalho":12,"P√£o de alho":8 },
  "Frangos": { "Frango assado na brasa + molho + farofa":25,"Frango na brasa + arroz + farofa + vinagrete + feij√£o tropeiro":40,"Frango assado + lingui√ßa Toscana + arroz + farofa + molho + feij√£o tropeiro + salpic√£o":60 },
  "Churrascos mistos": { "Churrasco misto":50,"Churrasco misto + arroz + farofa + molho":70,"Churrasco misto + arroz + feij√£o tropeiro + molho":80 },
  "Guarni√ß√µes": { "Arroz":15,"Feij√£o tropeiro":25,"Salpic√£o":25,"Farofa":10,"Vinagrete":7 }
};

let cart = {};
const chatEl = document.getElementById('chat');
const msgBox = document.getElementById('msgBox');
const sendBtn = document.getElementById('sendBtn');
const cartListEl = document.getElementById('cartList');
const subtotalText = document.getElementById('subtotalText');

function formatBR(v){ return v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); }
function addMsgBot(html){ const div=document.createElement('div'); div.className='msg-bot'; div.innerHTML=html; chatEl.appendChild(div); chatEl.scrollTop=chatEl.scrollHeight; }
function addMsgUser(text){ const div=document.createElement('div'); div.className='msg-user'; div.innerText=text; chatEl.appendChild(div); chatEl.scrollTop=chatEl.scrollHeight; }

function renderCategories(){
  chatEl.querySelectorAll('.cat-btn, .item-btn').forEach(b=>b.remove());
  addMsgBot('<b>üçñ Card√°pio:</b>');
  Object.keys(PRODUCTS).forEach(cat=>{
    const btn = document.createElement('button');
    btn.className='cat-btn';
    btn.innerText=cat;
    btn.onclick=()=>showItems(cat);
    chatEl.appendChild(btn);
  });
}

function showItems(cat){
  chatEl.querySelectorAll('.cat-btn, .item-btn').forEach(b=>b.remove());
  addMsgBot(`<b>${cat}:</b>`);
  Object.entries(PRODUCTS[cat]).forEach(([name,price])=>{
    const btn=document.createElement('button');
    btn.className='item-btn';
    btn.innerText=`${name} ‚Äî ${formatBR(price)}`;
    btn.onclick=()=> {
      addToCart(name, price);
      btn.remove(); // some o bot√£o ap√≥s adicionar
      addMsgBot("Digite 'finalizar' ou 'menu' para adicionar mais itens.");
    };
    chatEl.appendChild(btn);
  });
}

function renderCart(){
  const keys=Object.keys(cart);
  if(keys.length===0){ cartListEl.innerHTML='Vazio'; subtotalText.innerText='Subtotal: R$0,00'; return; }
  cartListEl.innerHTML='';
  let subtotal=0;
  keys.forEach(k=>{
    const it=cart[k];
    subtotal+=it.price*it.qty;
    const div=document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`
      ${it.name} x${it.qty} ‚Äî ${formatBR(it.price*it.qty)}
      <span>
        <button class="small-btn" onclick="changeQty('${it.name}',-1)">-</button>
        <button class="small-btn" onclick="changeQty('${it.name}',1)">+</button>
        <button class="small-btn" onclick="removeItem('${it.name}')">Remover</button>
      </span>
    `;
    cartListEl.appendChild(div);
  });
  subtotalText.innerText=`Subtotal: ${formatBR(subtotal)}`;
}

function addToCart(name,price){
  if(cart[name]) cart[name].qty++; else cart[name]={name,price,qty:1};
  addMsgBot(`‚úÖ Adicionado: ${name} ‚Äî ${formatBR(price)}`);
  renderCart();
}

function changeQty(name,delta){
  if(!cart[name]) return;
  cart[name].qty+=delta;
  if(cart[name].qty<=0) delete cart[name];
  renderCart();
}

function removeItem(name){ if(cart[name]){ delete cart[name]; renderCart(); addMsgBot(`‚ùå Removido: ${name}`); } }

function montarTextoWhatsApp(){
  let text="üçñ Novo Pedido üçñ\n";
  Object.values(cart).forEach(it=> text+=`‚Ä¢ ${it.name} x${it.qty} ‚Äî ${formatBR(it.price*it.qty)}\n`);
  let total=Object.values(cart).reduce((a,b)=>a+b.price*b.qty,0);
  text+=`Total: ${formatBR(total)}`;
  return encodeURIComponent(text);
}

function processInput(text){
  const lower=text.toLowerCase();
  addMsgUser(text);

  if(lower==='menu' || lower==='cardapio' || lower==='card√°pio'){ renderCategories(); return; }
  if(lower==='finalizar'){
    if(Object.keys(cart).length===0){ addMsgBot("Carrinho vazio!"); return; }
    const url=`https://wa.me/${WA_NUMBER}?text=${montarTextoWhatsApp()}`;
    window.open(url,'_blank');
    return;
  }
  if(lower.startsWith('remover ')){ removeItem(text.substring(8).trim()); return; }

  for(const cat in PRODUCTS){
    for(const [name,price] of Object.entries(PRODUCTS[cat])){
      if(name.toLowerCase()===lower){ addToCart(name,price); addMsgBot("Digite 'finalizar' ou 'menu' para adicionar mais itens."); return; }
    }
  }
  addMsgBot("N√£o entendi. Digite o nome do produto ou 'menu' para ver o card√°pio.");
}

sendBtn.onclick=()=>{ const t=msgBox.value.trim(); if(t){ processInput(t); msgBox.value=''; } }
msgBox.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); sendBtn.click(); } });

addMsgBot("üî• Ol√°! Sou o assistente do Churrasco do Chefe. Digite 'menu' para ver o card√°pio.");
renderCart();
</script>

</body>
</html>